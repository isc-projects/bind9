<!doctype html public "-//IETF//DTD HTML 2.0//EN">
<!-- $Id: dnsproxy.html,v 1.1 2001/03/05 12:58:03 tale Exp $ -->
<html>

<head>
<title>dnsproxy</title>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
</head>

<body>
<h1>dnsproxy</h1>

<ul>
<li><a href="#overview">概要</a>
<li><a href="#setup">設定</a>
<li><a href="#usage">使用法</a>
<li><a href="#limitation">制限事項</a>
</ul>

<hr>
<h2><a name="overview">概要</a></h2>

<p><b>dnsproxy</b> は文字通り DNS のプロキシサーバとして動作する
プログラムです。クライアントと本物の DNS サーバの間で両者の間の
通信データ (DNS プロトコルメッセージ) の変換を行います。

<p>クライアントからローカルエンコードされた多言語ドメイン名を含む
DNS要求を受け取ると、DNSメッセージ中のドメイン名を
多言語化対応したDNS サーバが受付けられる標準エンコーディングに変換し、
DNS サーバに送出します。
エンコーディングの変換と同時に正規化も行います。
また逆に DNS サーバからの応答メッセージを受信すると、その中に
含まれる多言語ドメイン名をクライアント側で認識できるローカル
エンコーディングに変換し、クライアントに返します。

<p>dnsproxy はこのようなメカニズムによって一般のクライアントが
多言語ドメイン名を扱うことを可能にします。

<p>具体的には、
<ul>
<li>日本語など、非 ASCII 文字の入ったホスト名を名前解決できるようになります。
<li>非 ASCII 文字の入ったホスト名を名前解決の結果として受け取れるように
  なります。
</ul>

<p>

<hr>
<h2><a name="setup">設定</a></h2>

<p>dnsproxy を使用するには、専用のコンフィギュレーションファイルで
使用するエンコーディングや正規化の方法を設定しておく必要があります。
このファイルの設定方法については
<a href="proxyconfig.html">DNS Proxy Server のコンフィギュレーション</a>
をご覧ください。

<p>

<hr>
<h2><a name="usage">使用法</a></h2>

<p>dnsproxy を使用するためにはあらかじめ設定が必要です。
<a href="proxyconfig.html">DNS Proxy Server のコンフィギュレーション</a>
をご覧ください。

<p>dnsproxy は以下のコマンド行オプションを受け付けます。
<dl>
<dt><tt>-daemon</tt>
  <dd>dnsproxy をデーモンとして起動します。
<dt><tt>-config </tt><em>config-file</em>
  <dd><em>config-file</em> をコンフィギュレーションファイルとして使用します。
  このオプションを指定しなかった場合にはデフォルトのコンフィギュレーション
  ファイル (通常は <tt>/usr/local/etc/dnsproxy.conf</tt>) が使用されます。
<dt><tt>-logfile </tt><em>log-file</em>
  <dd>ログをファイル <em>log-file</em> に出力します。このオプションが
  指定されなかった場合にはコンフィギュレーションファイルで指定された
  ログファイル、またはデフォルトのログファイルに出力されます。
</dl>

<hr>
<h2><a name="limitation">制限事項</a></h2>

<p>dnsproxy は、エンコーディング変換や正規化の機能を持たない
一般のクライアントが多言語ドメイン名を扱うことを可能にします。
クライアントではローカルコードで記述されたドメイン名を、
そのまま多言語ドメイン名として使うことができるようになります。

<p>しかしそれにはクライアントがドメイン名に対して独自のチェックや変換を
行なっていなければ、という前提条件があります。
問題はこの点にあり、
クライアントによっては、ドメイン名のシンタックスを厳密にチェックしていたり、
独自の手法で部分的に多言語化していたりするものがあります。
このようなクライアントであれば、dnsproxyを使っても
多言語ドメイン名を使うことはできません。

<p>UNIXの場合は、DNSへの要求は通常リゾルバライブラリを経由して送られますが、
既存のリゾルバはドメイン名のシンタックスをチェックしていて、
ドメイン名にnon-ASCIIコードが含まれているとエラーとして
はじかれてしまいます。
この問題に対処するために、mDNkitには、bind8付属のリゾルバライブラリを
8ビット透過にするためのパッチが付属しています。このパッチを適用した
リゾルバライブラリを組み込めば、クライアントからのローカルコードによる
多言語ドメイン名がdnsproxyに渡されて、多言語化DNSサーバと組み合わせて
使用することができるようになります。
Windowsの場合には、リゾルバ(WINSOCK)は8ビット透過になっていますので、
この問題はありません。

<p>残る問題は、アプリケーションでのチェックや変換ですが、
これは対象となるクライアントが多数ありますし、また、
ソースが公開されていないものについては手の出しようがありませんので、
基本的には、mDNkitには含まれていません。しかし、
DNSのチェックに多用される<b>nslookup(in bind8)</b>と、
汎用のproxyとして使用されることの多い<b>squid</b>については、
ドメイン名のチェックを外すためのパッチが含まれています。

<p>dnsproxy を使用してどのようなアプリケーションが多言語ドメイン名を
扱えるようになるのかをまとめた
<a href="clientconfig.html">文書</a>を用意してありますので、
こちらをご覧ください。

</body>
</html>