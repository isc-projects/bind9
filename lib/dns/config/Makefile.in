# Copyright (C) 1998-2001  Internet Software Consortium.
#
# Permission to use, copy, modify, and distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND INTERNET SOFTWARE CONSORTIUM
# DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL
# INTERNET SOFTWARE CONSORTIUM BE LIABLE FOR ANY SPECIAL, DIRECT,
# INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING
# FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,
# NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION
# WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

# $Id: Makefile.in,v 1.27 2001/01/09 23:55:17 bwelling Exp $

srcdir		= @srcdir@
VPATH		= @srcdir@
top_srcdir	= @top_srcdir@

YACC		= @YACC@
PERL		= @PERL@

@BIND9_VERSION@

@BIND9_INCLUDES@

CINCLUDES =	${DNS_INCLUDES} ${ISC_INCLUDES}

CDEFINES	=
CWARNINGS	=

LIBS		= @LIBS@

# Alphabetically

OBJS		= confparser.@O@ confcommon.@O@ confacl.@O@ confcache.@O@ \
		  confctl.@O@ confctx.@O@ confip.@O@ confkeys.@O@ conflog.@O@ \
		  conflsn.@O@ conflwres.@O@ confndc.@O@ confresolv.@O@ \
		  confrrset.@O@ confview.@O@ confzone.@O@

SRCS		= confparser.c confcommon.c confacl.c confcache.c \
		  confctl.c confctx.c confip.c confkeys.c conflog.c \
		  conflsn.c conflwres.c confndc.c confresolv.c \
		  confrrset.c confview.c confzone.c

SUBDIRS		=
TARGETS		= ${OBJS}

@BIND9_MAKE_RULES@

##confparser.c: confparser.y
##	${YACC} -d ${srcdir}/confparser.y
##	rm -f confparser.c confparser_p.h
##	mv y.tab.c confparser.c
##	mv y.tab.h confparser_p.h

## This rule is here during development to help debugging.
## Remove and uncomment the rule above before release.
confparser.c: confparser.y
	${YACC} -d ${srcdir}/confparser.y
	rm -f confparser.c confparser_p.h
	sed -e '/^\# *line/d' -e 's/^\(char \* *yy.*\[\]\)/const \1/' \
	    -e 's/{ \(char \*t_name; int t_val; } yytoktype;\)/{ const \1/' \
		< y.tab.c > confparser.c
	rm -f y.tab.c
	chmod a-w confparser.c
	mv y.tab.h confparser_p.h

#ifndef NOMINUM_PUBLIC
## This rule is here only for Nominum internal use.  The above "comment"
## will cause the sanitizer to remove it
confparser.y: confparser.y.dirty
	${PERL} ../../../util/sanitize.pl -iNOMINUM_PUBLIC - \
		< confparser.y.dirty > confparser.y
#endif NOMINUM_PUBLIC

depend: confparser.c

clean::
	rm -f confparser.c

#ifndef NOMINUM_PUBLIC
distclean::
	rm -f confparser_p.h confparser.y
#else NOMINUM_PUBLIC
#+distclean::
#+	rm -f confparser_p.h
#endif NOMINUM_PUBLIC
